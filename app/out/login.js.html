<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: login.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: login.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React from 'react';
import FORMAT from './style.css';
import {connect} from 'react-redux';
import * as actions from '../actions';
import {
    Link,
    useHistory,
    useLocation
  } from "react-router-dom";
class Login extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
        usernameOrEmail : '', 
        password : '',
        loading: false,
        errorText: '',
        showError: false
    }
    this._bootstrapAsync();
  }

  /**
   * 
   */
  _bootstrapAsync = async () => {
    let accessToken = localStorage.getItem('accessToken')
    this.props.history.push(accessToken ? "/dashboard": "/");
    if(await accessToken == null){
        localStorage.removeItem('accessToken');
        this.props.history.push("/")
    }
  };

  handleUsernameChange(event) {
    this.setState({usernameOrEmail: event.target.value});
  }
  
  handlePasswordChange(event) {
    this.setState({password: event.target.value});
  }

	render() {
	  return (
            &lt;main>
        &lt;nav>
        &lt;/nav>
        &lt;div id="login">
            &lt;div id="header">
                &lt;header>
                    &lt;h2 class={FORMAT.right_shift}>Existing User&lt;/h2>
                    &lt;h3 class={FORMAT.right_shift}>Required fields:&lt;span> *&lt;/span>&lt;/h3>
                &lt;/header>
            &lt;/div>
            &lt;p class={FORMAT.right_shift}>Log into your account:&lt;/p>
                {this.state.showError ? (
                                &lt;p class={FORMAT.right_shift}>{this.state.errorText}&lt;/p>
                ) : null}
                &lt;label for="email" class={FORMAT.right_shift}>Email: &lt;/label>
                &lt;input type="email" value={this.state.value}  onChange={(e) => this.handleUsernameChange(e)}  required />&lt;span id={FORMAT.email_required}> *&lt;/span>

                &lt;label for="password" class={FORMAT.right_shift}>Password: &lt;/label>
                &lt;input type="password" value={this.state.password} onChange={(e) => this.handlePasswordChange(e)} required />&lt;span id={FORMAT.password_required}> *&lt;/span>
                
                &lt;button id={FORMAT.login_button} onClick={()=> this.loginUser()}>Login&lt;/button>
            &lt;p>&lt;a href="./dashboard" alt="Password reset page" class={FORMAT.right_shift}>Forgot your password?&lt;/a>&lt;/p>
        &lt;/div>

        &lt;div id={FORMAT.sign_up}>
            &lt;form action="" method="post">
                &lt;header>
                    &lt;h2 class={FORMAT.right_shift}>New User&lt;/h2>
                &lt;/header>
                &lt;section>
                    &lt;p class={FORMAT.righ_shift}>Create new user account:&lt;/p>
                    &lt;button id={FORMAT.signup_button} >&lt;Link to="/signup">Sign up&lt;/Link>&lt;/button>
                &lt;/section>
            &lt;/form>
        &lt;/div>
    &lt;/main>
	  )
	}

  async loginUser() {
    await fetch("http://localhost:5000/api/auth/signin", {
      method: 'POST',
      headers: {
        Accept: 'application/json',
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        usernameOrEmail: this.state.usernameOrEmail,
        password: this.state.password
      }),
    })
        .then((response) => {
          if (response.ok) {
                response.json().then(responseJson => {
                localStorage.setItem('accessToken', responseJson.accessToken);
                this.props.Auth(responseJson.accessToken);
                this.props.history.push("/dashboard");
            });
          }else{
            this.setState({loading: false})
            this.setState({showError: true , errorText: 'The Username or Password is incorrect!'});
          }
        })
        .catch((error) => {
          this.setState({loading: false})
          this.setState({showError: true , errorText: 'Something went wrong. Please try again!'});
          console.log(error);
        });
  }

}


export default connect(null, actions)(Login)

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Fri Feb 21 2020 10:54:29 GMT-0600 (Central Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
